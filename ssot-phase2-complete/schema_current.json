{
  "metadata": {
    "project": "Suburbmates",
    "phase": "Phase 1 - Schema Analysis",
    "generatedOn": "2025-11-03",
    "sourceFile": "drizzle/schema.ts",
    "analysisMethod": "Manual filesystem MCP inspection",
    "orm": "Drizzle ORM",
    "database": "MySQL"
  },
  "tables": {
    "users": {
      "primaryKey": "id",
      "columns": {
        "id": { "type": "int", "autoincrement": true, "primaryKey": true },
        "openId": {
          "type": "varchar(64)",
          "unique": true,
          "notNull": true,
          "description": "Manus OAuth identifier"
        },
        "name": { "type": "text", "nullable": true },
        "email": { "type": "varchar(320)", "nullable": true },
        "loginMethod": { "type": "varchar(64)", "nullable": true },
        "role": {
          "type": "enum",
          "values": ["user", "admin", "buyer", "business_owner", "vendor"],
          "default": "user",
          "notNull": true
        },
        "createdAt": {
          "type": "timestamp",
          "defaultNow": true,
          "notNull": true
        },
        "updatedAt": {
          "type": "timestamp",
          "defaultNow": true,
          "onUpdateNow": true,
          "notNull": true
        },
        "lastSignedIn": {
          "type": "timestamp",
          "defaultNow": true,
          "notNull": true
        }
      },
      "indexes": [],
      "foreignKeys": [],
      "relations": {
        "businesses": { "type": "one-to-many", "target": "businesses" },
        "consents": { "type": "one-to-many", "target": "consents" }
      }
    },
    "melbourne_suburbs": {
      "primaryKey": "id",
      "columns": {
        "id": { "type": "int", "autoincrement": true, "primaryKey": true },
        "suburb": { "type": "varchar(100)", "unique": true, "notNull": true },
        "postcode": { "type": "varchar(4)", "notNull": true },
        "latitude": { "type": "decimal(10,8)", "nullable": true },
        "longitude": { "type": "decimal(11,8)", "nullable": true },
        "createdAt": {
          "type": "timestamp",
          "defaultNow": true,
          "notNull": true
        }
      },
      "indexes": [],
      "foreignKeys": [],
      "relations": {},
      "purpose": "Geofencing reference for Melbourne hyper-local marketplace"
    },
    "businesses": {
      "primaryKey": "id",
      "columns": {
        "id": { "type": "int", "autoincrement": true, "primaryKey": true },
        "ownerId": { "type": "int", "notNull": true, "foreignKey": "users.id" },
        "businessName": { "type": "varchar(255)", "notNull": true },
        "abn": { "type": "varchar(11)", "unique": true, "nullable": true },
        "abnVerifiedStatus": {
          "type": "enum",
          "values": ["pending", "verified", "rejected"],
          "default": "pending",
          "notNull": true
        },
        "abnDetails": { "type": "text", "nullable": true, "format": "JSON" },
        "services": {
          "type": "text",
          "nullable": true,
          "format": "JSON array"
        },
        "about": { "type": "text", "nullable": true },
        "address": { "type": "varchar(500)", "nullable": true },
        "suburb": { "type": "varchar(100)", "nullable": true },
        "phone": { "type": "varchar(20)", "nullable": true },
        "website": { "type": "varchar(500)", "nullable": true },
        "openingHours": {
          "type": "text",
          "nullable": true,
          "format": "JSON object"
        },
        "profileImage": { "type": "varchar(500)", "nullable": true },
        "status": {
          "type": "enum",
          "values": ["active", "inactive", "suspended"],
          "default": "active",
          "notNull": true
        },
        "createdAt": {
          "type": "timestamp",
          "defaultNow": true,
          "notNull": true
        },
        "updatedAt": {
          "type": "timestamp",
          "defaultNow": true,
          "onUpdateNow": true,
          "notNull": true
        }
      },
      "indexes": ["ownerIdIdx", "abnIdx", "suburbIdx"],
      "foreignKeys": [{ "column": "ownerId", "references": "users.id" }],
      "relations": {
        "owner": { "type": "many-to-one", "target": "users" },
        "agreements": { "type": "one-to-many", "target": "agreements" }
      }
    },
    "agreements": {
      "primaryKey": "id",
      "columns": {
        "id": { "type": "int", "autoincrement": true, "primaryKey": true },
        "businessId": {
          "type": "int",
          "notNull": true,
          "foreignKey": "businesses.id"
        },
        "agreementType": {
          "type": "enum",
          "values": ["terms_of_service", "privacy_policy", "vendor_agreement"],
          "notNull": true
        },
        "version": { "type": "varchar(20)", "notNull": true },
        "acceptedAt": { "type": "timestamp", "notNull": true },
        "ipAddress": { "type": "varchar(45)", "nullable": true },
        "userAgent": { "type": "text", "nullable": true },
        "createdAt": {
          "type": "timestamp",
          "defaultNow": true,
          "notNull": true
        }
      },
      "indexes": ["businessIdIdx"],
      "foreignKeys": [
        { "column": "businessId", "references": "businesses.id" }
      ],
      "relations": {
        "business": { "type": "many-to-one", "target": "businesses" }
      }
    },
    "consents": {
      "primaryKey": "id",
      "columns": {
        "id": { "type": "int", "autoincrement": true, "primaryKey": true },
        "userId": { "type": "int", "notNull": true, "foreignKey": "users.id" },
        "action": {
          "type": "varchar(255)",
          "notNull": true,
          "description": "Consent action taken"
        },
        "timestamp": {
          "type": "timestamp",
          "defaultNow": true,
          "notNull": true
        },
        "immutableHash": {
          "type": "varchar(64)",
          "notNull": true,
          "description": "SHA-256 hash for integrity"
        }
      },
      "indexes": ["userIdIdx", "timestampIdx"],
      "foreignKeys": [{ "column": "userId", "references": "users.id" }],
      "relations": {
        "user": { "type": "many-to-one", "target": "users" }
      },
      "purpose": "Audit-ready consent logs with immutable cryptographic hashes"
    },
    "email_tokens": {
      "primaryKey": "id",
      "columns": {
        "id": { "type": "int", "autoincrement": true, "primaryKey": true },
        "email": { "type": "varchar(320)", "notNull": true },
        "token": { "type": "varchar(255)", "unique": true, "notNull": true },
        "expiresAt": { "type": "timestamp", "notNull": true },
        "usedAt": { "type": "timestamp", "nullable": true },
        "createdAt": {
          "type": "timestamp",
          "defaultNow": true,
          "notNull": true
        }
      },
      "indexes": ["emailIdx", "tokenIdx"],
      "foreignKeys": [],
      "relations": {},
      "purpose": "Passwordless email verification tokens"
    }
  },
  "summary": {
    "totalTables": 6,
    "totalColumns": 56,
    "totalIndexes": 10,
    "totalForeignKeys": 4,
    "totalRelations": 8,
    "features": [
      "Manus OAuth authentication",
      "Melbourne-specific geofencing",
      "ABN verification workflow",
      "Audit-ready consent tracking with immutable hashes",
      "Passwordless email authentication",
      "Business directory with vendor management",
      "Agreement tracking with version control"
    ]
  },
  "dataTypes": {
    "strings": ["varchar", "text"],
    "numbers": ["int", "decimal"],
    "dates": ["timestamp"],
    "enums": ["role", "abnVerifiedStatus", "status", "agreementType"]
  },
  "complianceFeatures": {
    "gdpr": {
      "consentTracking": "consents table with immutable hashes",
      "dataRetention": "timestamps on all entities",
      "auditTrail": "ipAddress and userAgent in agreements"
    },
    "australian": {
      "abnVerification": "businesses.abnVerifiedStatus",
      "businessRegister": "Integration with Australian Business Register (ABR)"
    }
  }
}
